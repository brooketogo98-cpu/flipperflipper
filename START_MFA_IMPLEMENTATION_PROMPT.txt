â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”’ MFA IMPLEMENTATION TASK - COMPLETE PROMPT FOR AI DEVELOPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

YOUR MISSION:
Implement Multi-Factor Authentication (MFA/2FA) for the Oranolio/Stitch RAT web application login system using TOTP (Time-based One-Time Password) compatible with Microsoft Authenticator, Google Authenticator, and similar apps.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“š CRITICAL: READ THESE DOCUMENTS FIRST (IN THIS EXACT ORDER)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. /workspace/MFA_PROJECT_SUMMARY.md
   â†’ Start here for quick overview and context

2. /workspace/LOGIN_SYSTEM_SECURITY_ANALYSIS.md  
   â†’ Understand current system, flaws, and what you're fixing

3. /workspace/MFA_IMPLEMENTATION_GUIDE_FOR_AI.md
   â†’ YOUR BIBLE - Complete step-by-step implementation guide
   â†’ Follow EVERY step exactly as written
   â†’ This assumes you know NOTHING and holds your hand through everything

4. /workspace/CLAUDE_AI_HANDOFF_PROMPT.md
   â†’ Additional context and requirements

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš¡ QUICK START INSTRUCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PHASE 1: PREPARATION (DO THIS FIRST)
â–¡ Read all 4 documentation files completely
â–¡ Understand current authentication flow in /workspace/web_app_real.py
â–¡ Backup the current system: tar -czf mfa_backup_$(date +%Y%m%d).tar.gz web_app_real.py config.py templates/
â–¡ Install dependencies: pip3 install pyotp==2.9.0 qrcode==7.4.2 pillow==10.1.0 cryptography==41.0.7

PHASE 2: IMPLEMENTATION (FOLLOW THE GUIDE)
Follow /workspace/MFA_IMPLEMENTATION_GUIDE_FOR_AI.md EXACTLY from STEP 1 to STEP 8

You will create these NEW files:
â–¡ /workspace/mfa_manager.py                    - Core MFA logic
â–¡ /workspace/mfa_database.py                   - Database operations  
â–¡ /workspace/create_mfa_tables.py              - Database schema
â–¡ /workspace/templates/mfa_setup.html          - MFA setup page
â–¡ /workspace/templates/mfa_verify.html         - MFA verification page
â–¡ /workspace/templates/mfa_backup_codes.html   - Backup codes display
â–¡ /workspace/test_mfa.py                       - Unit tests

You will modify these EXISTING files:
â–¡ /workspace/web_app_real.py                   - Update /login route, add MFA routes
â–¡ /workspace/config.py                         - Add MFA configuration (optional)

PHASE 3: TESTING (VERIFY EVERYTHING)
â–¡ Run: python3 test_mfa.py (all tests must pass)
â–¡ Manual testing: Login flow, QR code scanning, backup codes
â–¡ Security verification: Secrets encrypted, codes hashed, audit logs working

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ WHAT YOU'RE BUILDING - USER EXPERIENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FIRST-TIME LOGIN:
User â†’ Enters username + password
     â†’ Redirects to /mfa/setup  
     â†’ Scans QR code with Microsoft Authenticator
     â†’ Enters 6-digit code to verify
     â†’ Gets 10 backup recovery codes
     â†’ Downloads/saves backup codes
     â†’ Redirects to dashboard âœ…

SUBSEQUENT LOGINS:
User â†’ Enters username + password
     â†’ Redirects to /mfa/verify
     â†’ Opens authenticator app
     â†’ Enters current 6-digit code
     â†’ Redirects to dashboard âœ…

IF PHONE LOST:
User â†’ Enters username + password
     â†’ Redirects to /mfa/verify
     â†’ Clicks "Lost your device?"
     â†’ Enters backup recovery code
     â†’ Redirects to dashboard âœ…
     â†’ Prompted to reset MFA

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ” CRITICAL SECURITY REQUIREMENTS (NON-NEGOTIABLE)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… TOTP secrets MUST be encrypted in database (using Fernet/AES-128)
âœ… Backup codes MUST be hashed like passwords (SHA-256)
âœ… MFA setup/verify sessions MUST timeout after 5 minutes
âœ… Users MUST NOT be able to bypass MFA by URL manipulation
âœ… All MFA events MUST be logged to mfa_audit_log table
âœ… Failed MFA attempts MUST be tracked and rate limited
âœ… Encryption key file MUST have 0600 permissions (Linux/Unix)
âœ… Backup codes are ONE-TIME USE (deleted after use)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… SUCCESS CRITERIA - YOU'RE DONE WHEN ALL THESE PASS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FUNCTIONALITY:
â–¡ QR code displays correctly on /mfa/setup
â–¡ QR code scans successfully with Microsoft Authenticator  
â–¡ Manual secret entry works as alternative
â–¡ TOTP 6-digit code verification succeeds
â–¡ Invalid TOTP codes show helpful error
â–¡ 10 backup codes generate and display
â–¡ Backup codes download as text file
â–¡ Backup code recovery works
â–¡ Used backup codes cannot be reused
â–¡ Subsequent logins require MFA
â–¡ Session timeout works (5 minutes)

SECURITY:
â–¡ TOTP secrets encrypted in user_mfa table (verify with: sqlite3 /workspace/Application/stitch.db "SELECT mfa_secret FROM user_mfa LIMIT 1;")
â–¡ Backup codes hashed in user_mfa table  
â–¡ MFA events logged in mfa_audit_log table
â–¡ Cannot access /dashboard without completing MFA
â–¡ Direct URL access to /dashboard blocked until MFA verified
â–¡ Encryption key file exists: /workspace/Application/.mfa_encryption_key

DATABASE:
â–¡ user_mfa table created
â–¡ mfa_audit_log table created
â–¡ Indexes created on both tables
â–¡ Foreign key constraints working

CODE QUALITY:
â–¡ All unit tests pass: python3 test_mfa.py
â–¡ No Python syntax errors
â–¡ All imports resolve correctly
â–¡ Functions have docstrings
â–¡ Code follows PEP 8 style

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ COMMON MISTAKES TO AVOID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ DON'T store TOTP secrets as plaintext
âœ… DO encrypt with mfa_manager.encrypt_secret()

âŒ DON'T store backup codes as plaintext  
âœ… DO hash with mfa_manager.hash_backup_code()

âŒ DON'T skip backup before making changes
âœ… DO create backup tarball first

âŒ DON'T forget session timeouts
âœ… DO expire MFA sessions after 5 minutes

âŒ DON'T allow MFA bypass
âœ… DO enforce MFA check in @login_required decorator

âŒ DON'T forget to test with real authenticator app
âœ… DO test with Microsoft Authenticator on actual phone

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š DELIVERABLES - WHAT TO PROVIDE WHEN COMPLETE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. LIST OF FILES CREATED:
   - Confirm all 7 new files created with file sizes

2. LIST OF FILES MODIFIED:
   - Show git diff --stat for web_app_real.py and config.py

3. TEST RESULTS:
   - Output from: python3 test_mfa.py
   - Confirmation all 5 unit tests passed

4. DATABASE VERIFICATION:
   - Output from: sqlite3 /workspace/Application/stitch.db ".tables" | grep mfa
   - Confirm user_mfa and mfa_audit_log tables exist

5. SECURITY VERIFICATION:
   - Confirm secrets are encrypted (not readable plaintext)
   - Confirm backup codes are hashed
   - Show sample from mfa_audit_log table

6. MANUAL TEST CONFIRMATION:
   - Confirm QR code displays
   - Confirm QR scans with authenticator app
   - Confirm TOTP verification works
   - Confirm backup codes work

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ TROUBLESHOOTING QUICK REFERENCE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

If dependencies fail to install:
â†’ pip3 install --upgrade pip
â†’ pip3 install --force-reinstall pyotp qrcode pillow cryptography

If database errors occur:
â†’ python3 create_mfa_tables.py
â†’ Check: ls -la /workspace/Application/stitch.db

If TOTP always fails:
â†’ Check server time: date
â†’ Should be within 30 seconds of phone time
â†’ Install NTP: sudo apt-get install ntp

If QR code doesn't display:
â†’ Verify: python3 -c "from PIL import Image; print('OK')"
â†’ Reinstall: pip3 install --force-reinstall pillow

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ FILE LOCATIONS - QUICK REFERENCE MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Documentation (READ THESE):
/workspace/MFA_PROJECT_SUMMARY.md               â† Start here
/workspace/LOGIN_SYSTEM_SECURITY_ANALYSIS.md    â† Context & flaws
/workspace/MFA_IMPLEMENTATION_GUIDE_FOR_AI.md   â† FOLLOW THIS
/workspace/CLAUDE_AI_HANDOFF_PROMPT.md          â† Extra requirements

Current System (UNDERSTAND THESE):
/workspace/web_app_real.py                      â† Main Flask app (WILL MODIFY)
/workspace/config.py                            â† Configuration (WILL MODIFY)
/workspace/auth_utils.py                        â† Auth patterns to follow
/workspace/templates/login.html                 â† Current login page

What You'll Create:
/workspace/mfa_manager.py                       â† Core MFA logic
/workspace/mfa_database.py                      â† DB operations
/workspace/create_mfa_tables.py                 â† Schema creation
/workspace/test_mfa.py                          â† Unit tests
/workspace/templates/mfa_setup.html             â† Setup page
/workspace/templates/mfa_verify.html            â† Verify page
/workspace/templates/mfa_backup_codes.html      â† Backup codes page

Database:
/workspace/Application/stitch.db                â† SQLite database
/workspace/Application/.mfa_encryption_key      â† Auto-generated Fernet key

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¬ START HERE - IMMEDIATE NEXT STEPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Read /workspace/MFA_PROJECT_SUMMARY.md (5 minutes)
2. Read /workspace/MFA_IMPLEMENTATION_GUIDE_FOR_AI.md Section 1-3 (20 minutes)
3. Create backup: tar -czf mfa_backup_$(date +%Y%m%d).tar.gz web_app_real.py config.py templates/
4. Install dependencies: pip3 install pyotp qrcode pillow cryptography
5. Begin STEP 1 of implementation guide: Create mfa_manager.py
6. Follow guide steps 1-8 sequentially
7. Run tests and verify checklist
8. Report completion with deliverables

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ REMEMBER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

- The implementation guide has EVERY line of code you need
- Don't improvise - follow the guide exactly
- Test frequently as you implement
- Security is critical - don't skip encryption/hashing
- When in doubt, refer back to the guide
- The guide assumes you know nothing - it's designed for success

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ YOU'VE GOT THIS!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Everything you need is in /workspace/MFA_IMPLEMENTATION_GUIDE_FOR_AI.md

Follow it step by step, test thoroughly, and you'll build a secure, 
production-ready MFA system that works with Microsoft Authenticator.

Good luck! ğŸ”’âœ¨

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
END OF PROMPT - BEGIN IMPLEMENTATION NOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
